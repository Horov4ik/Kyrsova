# Підсистема обліку військовослужбовців — повний стек (React + Node + MongoDB)

Це навчальний проєкт — односторінковий додаток (SPA) для обліку військовослужбовців по роках випуску. Проєкт містить:

- Сервер на Node.js + Express з MongoDB (Mongoose) — CRUD для записів про військових, авторизація через JWT, адмінські ендпоінти для seed/clear/stats.
- Клієнт на React (Vite) — маршрутизація по роках, форма додавання/редагування, CSV-експорт, фільтр по підрозділу, та UI в стилі MM-14 (псевдо-камуфляжна палітра).

README описує, як підняти середовище розробки, первинне налаштування, використання скриптів посіву (seed) та міграції власника записів.

## Структура репозиторію

- `/server` — серверна частина (Express, Mongoose).
- `/client` — фронтенд (React, Vite).
- `README.md` — цей файл.

## Вимоги

- Node.js >= 16
- npm або yarn
- MongoDB (локально або MongoDB Atlas)

## Налаштування оточення

1. Скопіюйте репозиторій та перейдіть в корінь проєкту.

2. Створіть `.env` файл в папці `server` з такими змінними:

```
PORT=4000
MONGO_URI=mongodb://localhost:27017/kursova
JWT_SECRET=тут_ваш_секретний_ключ
```

3. При потребі налаштуйте CORS або інші параметри у `server/index.js`.

## Установка залежностей

В корені проєкту виконайте (або за потреби окремо у `client` та `server`):

```bash
# в корені
npm install

# або окремо
cd server
npm install
cd ../client
npm install
```

## Запуск у режимі розробки

В окремих терміналах запустіть сервер і клієнт:

```bash
# Термінал 1: сервер
cd server
npm run dev      # або node index.js / nodemon index.js

# Термінал 2: клієнт
cd client
npm run dev      # Vite dev server
```

Після цього відкрийте http://localhost:5173 (за замовчуванням Vite) або адресу, яку покаже Vite.

## Базові API-ендпоінти (огляд)

Сервер слухає префіксом `/api` (налаштовується в `server/index.js`). Нижче — короткий огляд.

- POST /api/auth/register — реєстрація користувача (username, password)
- POST /api/auth/login — логін -> повертає JWT
- GET /api/soldiers?yearOut=YYYY — список військових з фільтром по року випуску (запит без токена поверне порожній список або помилку)
- POST /api/soldiers — створити запис (передати заголовок Authorization: Bearer <token>)
- PUT /api/soldiers/:id — оновити запис (власник або admin)
- DELETE /api/soldiers/:id — видалити запис (власник або admin)
- GET /api/export/csv?yearOut=YYYY — експортує CSV для вказаного року (обмежено по власнику)

Адмін-ендпоінти (потребують користувача з роллю `admin` або виконання під власником):

- POST /api/admin/seed/:year — посіяти демо-дані для року (можна викликати для поточного користувача)
- POST /api/admin/clear/:year — очистити дані за рік
- GET /api/admin/stats/:year — отримати статистику підрозділів
- (opt) GET /api/admin/unowned/:year — список записів без власника (для міграції)
- (opt) POST /api/admin/claim/:year — присвоїти записи без власника конкретному користувачу (admin)

Зверніть увагу, що більшість запитів повертають дані лише для поточного користувача (поле `owner` в моделі Soldier). Адміністратор бачить усі записи.

## Міграція старих записів (якщо є)

Якщо в базі є записи без поля `owner` (створені до впровадження механізму власника), є два варіанти:

1. Виконати скрипт для присвоєння записів конкретному користувачу (скрипт створений у `server/scripts/claim_unowned.js`). Викликати з параметрами:

```bash
node server/scripts/claim_unowned.js <MONGO_URI> <TARGET_USER_ID>
```

2. Або тимчасово залогінитися як `admin` і використати ендпоінти `/api/admin/claim/:year`.

Перед запуском міграцій обов'язково зробіть бекап бази даних.

## Seed (наповнення тестовими даними)

Щоб додати зразкові дані для року, використайте ендпоінт:

```
POST /api/admin/seed/2025
Authorization: Bearer <token>
```

Це створить набір записів з унікальними іменами (FIO), з різними підрозділами та номером частини. За потреби змініть логіку у `server/routes/admin.js`.

## Експорт CSV

На сторінці конкретного року є кнопка "Експорт" — вона викликає `/api/export/csv?yearOut=YYYY` і повертає CSV-файл, відфільтрований по поточному користувачу або всім записам (якщо admin).

## Налаштування клієнта

- Токен авторизації зберігається в `localStorage.token` і автоматично додається в заголовки axios при доступності.
- Локальні налаштування, наприклад підписи випусків, зберігаються в `localStorage.releaseLabels`.

## Стилі та тема

Кольорова палітра оформлена в `client/src/styles.css` як набор CSS-змінних (MM-14 натхнення). Основні класи для оформлення:

- `.hero`, `.auth-card`, `.soldier-card`, `.btn-release`, `.app-header` тощо.
- Якщо потрібно змінити тему — редагуйте `:root { --camo-dark, --camo-mid, --camo-light, --accent }`.

## Корисні поради та усунення несправностей

- "Реєстрація випирає" — якщо блок реєстрації перекриває шапку, перевірте, чи остання версія `client/src/styles.css` присутня. Ми додали обмеження ширини/обтікання для `.auth-card`.
- Якщо ви не бачите своїх записів — перевірте, чи ви залогінені, та чи запит передає токен у заголовку Authorization.
- Для проблем з CORS — перевірте конфігурацію CORS у `server/index.js`.

## Тестування та lint

Проєкт містить мінімальний набір перевірок. Рекомендується встановити ESLint / Prettier у вашому середовищі і запускати локальний тестовий MongoDB при розробці.

## Подальші плани (опціонально)

- Додати кнопку "Seed for me" у фронтенді, щоб користувач міг згенерувати демо-записи для власного обліку.
- Додати UI для адміна, щоб масово присвоювати записи існуючим користувачам.
- Додати unit/integration тести для backend API.

---

Якщо хочете, я можу додати до README швидку інструкцію з Docker-сконфігурацією або готові docker-compose файли для одночасного підняття Mongo + сервер + клієнта. Хочете додати Docker-розгортання?

